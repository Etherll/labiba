<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <title>لبيبة</title>
    <link href="static/theme/semantic.rtl.min.css" rel="stylesheet" type="text/css" />
    <link href="static/css/editor.css" rel="stylesheet" type="text/css" />
  </head>
  <body>

    <div class="ui fixed menu red">
      <div class="ui dropdown as-menu">
        <div class="text">ملف</div>
        <i class="dropdown icon"></i>
        <div class="menu">
          <div class="item">جديد</div>
          <div id="btnOpen" class="item">
            <span class="description">ctrl + o</span>
            فتح...
          </div>
          <div id="btnSave" class="item">
            <span class="description">ctrl + o</span>
            حفظ
          </div>
          <div id="btnSaveAs" class="item">
            <span class="description">ctrl + s</span>
            حفظ بإسم ...
          </div>
          <div class="divider"></div>
          <div class="item">خروج</div>
        </div>
      </div>
    </div>

    <div class="ui menu toolbar red">
      <div class="item">
        <div id="btnRun" class="ui primary button">تشخيل</div>
      </div>
      <div class="item">
        <div class="ui button">Log-in</div>
      </div>
    </div>

     <div class="container-fluid main-container">
        <div class="page">
          <div class="page-content">
              <div class="row">
                  <div class="col">
                      <div id="editor">
                      </div>
                  </div>
                </div>
          </div>
          <div class="sidebar">
            side
          </div>
        </div>
      </div>
    <script>
      var jQuery
      const $ = require('jquery')     
      const labiba = require('./labiba-lib') 
      
      $(document).ready(function() {
        jQuery = $
        $('<script/>',{type:'text/javascript', src:'static/theme/semantic.min.js'}).appendTo('body');
        $('<script/>',{type:'text/javascript', src:'editor.js'}).appendTo('body');
        pageLoad()
      })
      
      function pageLoad() {
        $('.ui.dropdown').dropdown({
          action: 'select'
        });

        $('#btnRun').click(function() {
          const vm = require('vm');
          const la = require('labiba-transformer')
          let code = editor.getValue();
          
          code = `غير_متزامن مهمة runner(labiba) {
              ${code}
            };
            runner(labiba);
          `
          code = la.transform(code);
          console.log(code)
          var res =  vm.runInThisContext(code, 'sam.js');
          //sandbox.main()
        })


        $('#btnTest').click(function() {
          const Dialogs = require('dialogs')
          const dialogs = Dialogs()
          dialogs.alert('okidoki', ok => {
            console.log('alert', ok)
            dialogs.confirm('ok?', ok => {
              console.log('confirm', ok)
              dialogs.prompt('username', 'joe.smith@gmail.com', ok => {
                console.log('prompt with default', ok)
                dialogs.prompt('username', ok => {
                  console.log('prompt', ok)
                })
              })
            })
          })
        })


        $('#btnOpen').click(function(e) {
          e.preventDefault();
          const fs = require("fs")
          const electron = require('electron').remote
          const dialog = electron.dialog
          let file = dialog.showOpenDialog({ filters: [{name: 'لبيبة', extensions: ['la']}], properties: ['openFile'] })
          fs.readFile(file[0], function (err, data) {
              if (err) {
                return console.error(err);
              }
              editor.setValue(data.toString())
            });
          })

          $('#btnSaveAs').click(function(e) {
            e.preventDefault();
            const fs = require("fs")
            const electron = require('electron').remote
            const dialog = electron.dialog
            let file = dialog.showSaveDialog({ filters: [{name: 'لبيبة', extensions: ['la']}]})
            let content = editor.getValue()
            console.log(content)
            console.log(file)
            fs.writeFileSync(file[0], content, 'utf-8')
          })
      }
    </script>
  </body>
</html>